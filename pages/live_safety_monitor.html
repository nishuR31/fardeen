<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live Safety Monitor - Women Safety Analytics</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <script
      type="module"
      src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fwomensafe3398back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.9"
    ></script>
    <script
      type="module"
      src="https://static.rocket.new/rocket-shot.js?v=0.0.1"
    ></script>
  </head>
  <body class="bg-slate-900 text-slate-100 min-h-screen">
    <!-- Loading Overlay -->
    <div
      id="loadingOverlay"
      class="fixed inset-0 bg-slate-900 bg-opacity-95 flex items-center justify-center z-50 backdrop-blur-sm"
    >
      <div class="text-center">
        <div
          class="inline-flex items-center justify-center w-16 h-16 bg-emerald-500 rounded-full mb-4 animate-pulse"
        >
          <svg
            class="w-8 h-8 text-white animate-spin"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
            ></path>
          </svg>
        </div>
        <p class="text-lg font-medium text-slate-200">
          Initializing Safety Monitor...
        </p>
        <p class="text-sm text-slate-400 mt-2">
          Connecting to live data streams
        </p>
      </div>
    </div>

    <!-- Header Section -->
    <header
      class="bg-slate-800 border-b border-slate-700 px-6 py-4 sticky top-0 z-40 backdrop-blur-sm bg-slate-800/95"
    >
      <div class="flex items-center justify-between">
        <!-- Logo and Title -->
        <div class="flex items-center space-x-4">
          <div class="flex items-center space-x-2">
            <div class="relative">
              <svg
                class="w-8 h-8 text-emerald-500"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.9 1 3 1.9 3 3V21C3 22.1 3.9 23 5 23H19C20.1 23 21 22.1 21 21V9H21ZM19 21H5V3H13V9H19V21Z"
                />
              </svg>
              <div
                class="absolute -top-1 -right-1 w-3 h-3 bg-emerald-500 rounded-full animate-pulse"
              ></div>
            </div>
            <h1 class="text-xl font-semibold text-slate-100">
              Women Safety Analytics
            </h1>
          </div>
          <div class="h-6 w-px bg-slate-600"></div>
          <h2 class="text-lg font-medium text-emerald-400">
            Live Safety Monitor
          </h2>
        </div>

        <!-- Navigation -->
        <nav class="hidden md:flex items-center space-x-6">
          <a
            href="live_safety_monitor.html"
            class="px-4 py-2 rounded-lg bg-emerald-600 text-white font-medium shadow-lg hover:bg-emerald-700 transition-all duration-200"
            >Live Monitor</a
          >
          <a
            href="threat_analytics_hub.html"
            class="px-4 py-2 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200"
            >Analytics Hub</a
          >
          <a
            href="emergency_response.html"
            class="px-4 py-2 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition-all duration-200"
            >Emergency Response</a
          >
        </nav>

        <!-- Global Controls -->
        <div class="flex items-center space-x-4">
          <!-- Connection Status -->
          <div class="flex items-center space-x-2 text-sm">
            <div
              class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"
              id="connectionStatus"
            ></div>
            <span class="text-slate-400" id="connectionText">Connected</span>
          </div>

          <!-- Auto-refresh Controls -->
          <div
            class="flex items-center space-x-2 bg-slate-700 rounded-lg px-3 py-2"
          >
            <button
              title="button"
              type="button"
              id="refreshToggle"
              class="text-emerald-400 hover:text-emerald-300 transition-colors"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                ></path>
              </svg>
            </button>
            <span class="text-xs text-slate-400"
              >Auto: <span id="refreshInterval">5s</span></span
            >
          </div>

          <!-- Location Selector -->
          <select
            title="select"
            id="locationSelector"
            class="bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all"
          >
            <option value="downtown">Downtown Campus</option>
            <option value="north">North District</option>
            <option value="central">Central Plaza</option>
            <option value="university">University Area</option>
          </select>

          <!-- Mobile Menu Button -->
          <button
            title="button"
            type="button"
            id="mobileMenuToggle"
            class="md:hidden p-2 rounded-lg text-slate-400 hover:text-white hover:bg-slate-700 transition-all"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              ></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Mobile Navigation -->
      <nav
        id="mobileNav"
        class="md:hidden mt-4 pt-4 border-t border-slate-700 hidden"
      >
        <div class="flex flex-wrap gap-2">
          <a
            href="live_safety_monitor.html"
            class="px-3 py-2 rounded-lg bg-emerald-600 text-white text-sm font-medium"
            >Live Monitor</a
          >
          <a
            href="threat_analytics_hub.html"
            class="px-3 py-2 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 text-sm transition-colors"
            >Analytics</a
          >
          <a
            href="emergency_response.html"
            class="px-3 py-2 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 text-sm transition-colors"
            >Emergency</a
          >
        </div>
      </nav>
    </header>

    <!-- Main Dashboard Content -->
    <main class="p-6 space-y-6">
      <!-- Key Metrics Summary Bar -->
      <section class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div
          class="bg-slate-800 rounded-xl p-4 border border-slate-700 hover:border-emerald-500/50 transition-all duration-300 group"
        >
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-slate-400 mb-1">Total Monitored</p>
              <p class="text-2xl font-bold text-slate-100" id="totalMonitored">
                0
              </p>
            </div>
            <div
              class="w-12 h-12 bg-emerald-500/20 rounded-lg flex items-center justify-center group-hover:bg-emerald-500/30 transition-all"
            >
              <svg
                class="w-6 h-6 text-emerald-400"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M16,4C18.11,4 20.11,4.89 21.61,6.39C23.11,7.89 24,9.89 24,12A8,8 0 0,1 16,20H5A5,5 0 0,1 0,15A5,5 0 0,1 5,10C5.59,10 6.16,10.13 6.69,10.36C7.85,7.53 10.65,5.5 14,5.5C14.66,5.5 15.31,5.6 15.93,5.78C16,5.52 16,5.26 16,5A1,1 0 0,1 16,4Z"
                />
              </svg>
            </div>
          </div>
          <div class="mt-2 flex items-center text-xs">
            <span class="flex items-center text-emerald-400">
              <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path
                  fill-rule="evenodd"
                  d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"
                  clip-rule="evenodd"
                ></path>
              </svg>
              +12%
            </span>
            <span class="text-slate-500 ml-2">vs last hour</span>
          </div>
        </div>

        <div
          class="bg-slate-800 rounded-xl p-4 border border-slate-700 hover:border-pink-500/50 transition-all duration-300 group"
        >
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-slate-400 mb-1">Female Presence</p>
              <p class="text-2xl font-bold text-pink-400" id="femalePresence">
                0%
              </p>
            </div>
            <div
              class="w-12 h-12 bg-pink-500/20 rounded-lg flex items-center justify-center group-hover:bg-pink-500/30 transition-all"
            >
              <svg
                class="w-6 h-6 text-pink-400"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M12,4A6,6 0 0,1 18,10C18,12.97 15.84,15.44 13,15.92V18H15V20H13V22H11V20H9V18H11V15.92C8.16,15.44 6,12.97 6,10A6,6 0 0,1 12,4M12,6A4,4 0 0,0 8,10A4,4 0 0,0 12,14A4,4 0 0,0 16,10A4,4 0 0,0 12,6Z"
                />
              </svg>
            </div>
          </div>
          <div class="mt-2 flex items-center text-xs">
            <span class="flex items-center text-pink-400">
              <div
                class="w-2 h-2 bg-pink-400 rounded-full mr-2 animate-pulse"
              ></div>
              Live tracking
            </span>
          </div>
        </div>

        <div
          class="bg-slate-800 rounded-xl p-4 border border-slate-700 hover:border-amber-500/50 transition-all duration-300 group"
        >
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-slate-400 mb-1">Active Alerts</p>
              <p class="text-2xl font-bold text-amber-400" id="activeAlerts">
                0
              </p>
            </div>
            <div
              class="w-12 h-12 bg-amber-500/20 rounded-lg flex items-center justify-center group-hover:bg-amber-500/30 transition-all"
            >
              <svg
                class="w-6 h-6 text-amber-400"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path d="M13,14H11V10H13M13,18H11V16H13M1,21H23L12,2L1,21Z" />
              </svg>
            </div>
          </div>
          <div class="mt-2 flex items-center text-xs">
            <span class="text-slate-500"
              >Last alert: <span id="lastAlertTime">None</span></span
            >
          </div>
        </div>

        <div
          class="bg-slate-800 rounded-xl p-4 border border-slate-700 hover:border-blue-500/50 transition-all duration-300 group"
        >
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-slate-400 mb-1">Response Time</p>
              <p class="text-2xl font-bold text-blue-400" id="responseTime">
                0s
              </p>
            </div>
            <div
              class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center group-hover:bg-blue-500/30 transition-all"
            >
              <svg
                class="w-6 h-6 text-blue-400"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"
                />
              </svg>
            </div>
          </div>
          <div class="mt-2 flex items-center text-xs">
            <span class="flex items-center text-emerald-400">
              <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path
                  fill-rule="evenodd"
                  d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z"
                  clip-rule="evenodd"
                ></path>
              </svg>
              -23%
            </span>
            <span class="text-slate-500 ml-2">improved</span>
          </div>
        </div>
      </section>

      <!-- Dashboard Grid Layout -->
      <div class="grid grid-cols-1 lg:grid-cols-24 gap-6">
        <!-- Left Section: Live Camera Feeds (8 cols) -->
        <section class="lg:col-span-8 space-y-4">
          <div
            class="bg-slate-800 rounded-xl p-6 border border-slate-700 shadow-2xl"
          >
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-xl font-bold text-slate-100 flex items-center">
                <div
                  class="w-2 h-2 bg-emerald-500 rounded-full mr-3 animate-pulse"
                ></div>
                Live Camera Feeds
              </h3>
              <div class="flex items-center space-x-4">
                <div
                  class="flex items-center space-x-2 bg-slate-700 rounded-lg px-3 py-1.5"
                >
                  <span class="text-sm text-slate-400">Active:</span>
                  <span
                    class="text-sm font-bold text-emerald-400"
                    id="activeCameraCount"
                    >0</span
                  >
                  <span class="text-sm text-slate-500">/</span>
                  <span class="text-sm text-slate-400" id="totalCameraCount"
                    >16</span
                  >
                </div>
                <button
                  title="button"
                  type="button"
                  id="fullscreenCameras"
                  class="p-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-300 hover:text-white transition-all"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"
                    ></path>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Camera Grid -->
            <div class="grid grid-cols-2 gap-4" id="cameraGrid">
              <!-- Cameras will be dynamically populated -->
            </div>

            <!-- Camera Controls -->
            <div class="mt-6 flex items-center justify-between">
              <button
                title="button"
                type="button"
                id="enableAllCameras"
                class="bg-emerald-600 hover:bg-emerald-700 text-white text-sm px-6 py-3 rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-emerald-500/25"
              >
                <svg
                  class="w-4 h-4 mr-2 inline"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                  ></path>
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                  ></path>
                </svg>
                Enable All Cameras
              </button>
              <button
                title="button"
                type="button"
                id="viewFullGrid"
                class="bg-slate-600 hover:bg-slate-700 text-white text-sm px-6 py-3 rounded-lg font-medium transition-all duration-200"
              >
                <svg
                  class="w-4 h-4 mr-2 inline"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"
                  ></path>
                </svg>
                View Full Grid
              </button>
            </div>
          </div>
        </section>

        <!-- Center Section: Gender Distribution Analytics (10 cols) -->
        <section class="lg:col-span-10 space-y-4">
          <div
            class="bg-slate-800 rounded-xl p-6 border border-slate-700 shadow-2xl"
          >
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-xl font-bold text-slate-100">
                Real-Time Gender Distribution
              </h3>
              <div class="flex items-center space-x-4">
                <div
                  class="flex items-center space-x-2 text-sm text-slate-400 bg-slate-700 rounded-lg px-3 py-1.5"
                >
                  <div
                    class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"
                  ></div>
                  <span>Live Analytics</span>
                </div>
                <button
                  title="button"
                  type="button"
                  id="exportAnalytics"
                  class="p-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-300 hover:text-white transition-all"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                    ></path>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Gender Analytics Chart -->
            <div class="space-y-8">
              <!-- Circular Progress Chart -->
              <div class="flex items-center justify-center mb-8">
                <div class="relative w-48 h-48">
                  <svg
                    class="w-full h-full transform -rotate-90"
                    viewBox="0 0 100 100"
                  >
                    <!-- Background circle -->
                    <circle
                      cx="50"
                      cy="50"
                      r="40"
                      stroke="rgb(51, 65, 85)"
                      stroke-width="8"
                      fill="none"
                    />
                    <!-- Female arc -->
                    <circle
                      id="femaleArc"
                      cx="50"
                      cy="50"
                      r="40"
                      stroke="rgb(236, 72, 153)"
                      stroke-width="8"
                      fill="none"
                      stroke-dasharray="0 251.2"
                      stroke-linecap="round"
                      class="transition-all duration-1000"
                    />
                    <!-- Male arc -->
                    <circle
                      id="maleArc"
                      cx="50"
                      cy="50"
                      r="40"
                      stroke="rgb(59, 130, 246)"
                      stroke-width="8"
                      fill="none"
                      stroke-dasharray="0 251.2"
                      stroke-linecap="round"
                      class="transition-all duration-1000"
                    />
                  </svg>
                  <div
                    class="absolute inset-0 flex items-center justify-center"
                  >
                    <div class="text-center">
                      <div
                        class="text-3xl font-bold text-slate-100"
                        id="totalCountCircle"
                      >
                        0
                      </div>
                      <div class="text-sm text-slate-400">Total People</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Distribution Bars -->
              <div class="space-y-6">
                <!-- Female Distribution -->
                <div class="space-y-3">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                      <div
                        class="w-4 h-4 bg-pink-500 rounded-full shadow-lg shadow-pink-500/50"
                      ></div>
                      <span class="text-lg font-semibold text-slate-200"
                        >Female</span
                      >
                    </div>
                    <div class="text-right">
                      <span
                        class="text-2xl font-bold text-pink-400"
                        id="femalePercentage"
                        >0%</span
                      >
                      <div class="text-sm text-slate-400">
                        <span id="femaleCount">0</span> individuals
                      </div>
                    </div>
                  </div>
                  <div class="relative">
                    <div
                      class="w-full bg-slate-700 rounded-full h-4 shadow-inner"
                    >
                      <div
                        id="femaleBar"
                        class="bg-gradient-to-r from-pink-500 to-pink-400 h-4 rounded-full transition-all duration-1000 ease-out shadow-lg shadow-pink-500/25"
                        style="width: 0%"
                      ></div>
                    </div>
                    <div
                      class="absolute right-2 top-1/2 transform -translate-y-1/2 text-xs font-medium text-white opacity-0 transition-opacity duration-300"
                      id="femaleBarText"
                    ></div>
                  </div>
                </div>

                <!-- Male Distribution -->
                <div class="space-y-3">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                      <div
                        class="w-4 h-4 bg-blue-500 rounded-full shadow-lg shadow-blue-500/50"
                      ></div>
                      <span class="text-lg font-semibold text-slate-200"
                        >Male</span
                      >
                    </div>
                    <div class="text-right">
                      <span
                        class="text-2xl font-bold text-blue-400"
                        id="malePercentage"
                        >0%</span
                      >
                      <div class="text-sm text-slate-400">
                        <span id="maleCount">0</span> individuals
                      </div>
                    </div>
                  </div>
                  <div class="relative">
                    <div
                      class="w-full bg-slate-700 rounded-full h-4 shadow-inner"
                    >
                      <div
                        id="maleBar"
                        class="bg-gradient-to-r from-blue-500 to-blue-400 h-4 rounded-full transition-all duration-1000 ease-out shadow-lg shadow-blue-500/25"
                        style="width: 0%"
                      ></div>
                    </div>
                    <div
                      class="absolute right-2 top-1/2 transform -translate-y-1/2 text-xs font-medium text-white opacity-0 transition-opacity duration-300"
                      id="maleBarText"
                    ></div>
                  </div>
                </div>
              </div>

              <!-- Location Breakdown -->
              <div class="pt-6 border-t border-slate-700">
                <h4 class="text-lg font-semibold text-slate-200 mb-4">
                  Location Breakdown
                </h4>
                <div class="grid grid-cols-2 gap-4" id="locationBreakdown">
                  <!-- Locations will be dynamically populated -->
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Right Section: Safety Status & Statistics (6 cols) -->
        <section class="lg:col-span-6 space-y-4">
          <!-- Safety Status -->
          <div
            class="bg-slate-800 rounded-xl p-6 border border-slate-700 shadow-2xl"
          >
            <h3 class="text-xl font-bold text-slate-100 mb-6">Safety Status</h3>

            <!-- Overall Status Badge -->
            <div class="text-center mb-8">
              <div
                id="safetyIndicator"
                class="inline-flex items-center justify-center w-28 h-28 bg-emerald-500 rounded-full mb-4 shadow-2xl shadow-emerald-500/30 transition-all duration-500"
              >
                <svg
                  class="w-14 h-14 text-white"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9L10,17Z"
                  />
                </svg>
              </div>
              <div
                class="text-3xl font-bold text-emerald-400 mb-2"
                id="safetyStatus"
              >
                SAFE
              </div>
              <div class="text-sm text-slate-400" id="safetyDescription">
                All areas secure
              </div>
            </div>

            <!-- Quick Stats -->
            <div class="space-y-4">
              <div
                class="flex items-center justify-between p-3 bg-slate-700/50 rounded-lg"
              >
                <span class="text-sm text-slate-300 flex items-center">
                  <svg
                    class="w-4 h-4 mr-2 text-emerald-400"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      d="M15,7V9H9V7H15M11,15H13V11H11V15M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"
                    />
                  </svg>
                  Active Cameras
                </span>
                <span
                  class="text-lg font-bold text-emerald-400"
                  id="activeCamerasStatus"
                  >0/16</span
                >
              </div>
              <div
                class="flex items-center justify-between p-3 bg-slate-700/50 rounded-lg"
              >
                <span class="text-sm text-slate-300 flex items-center">
                  <svg
                    class="w-4 h-4 mr-2 text-amber-400"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      d="M13,14H11V10H13M13,18H11V16H13M1,21H23L12,2L1,21Z"
                    />
                  </svg>
                  Current Alerts
                </span>
                <span
                  class="text-lg font-bold text-slate-400"
                  id="currentAlertsStatus"
                  >0</span
                >
              </div>
              <div
                class="flex items-center justify-between p-3 bg-slate-700/50 rounded-lg"
              >
                <span class="text-sm text-slate-300 flex items-center">
                  <svg
                    class="w-4 h-4 mr-2 text-blue-400"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"
                    />
                  </svg>
                  Response Time
                </span>
                <span
                  class="text-lg font-bold text-emerald-400"
                  id="responseTimeStatus"
                  >< 2min</span
                >
              </div>
            </div>
          </div>

          <!-- Emergency Controls -->
          <div
            class="bg-slate-800 rounded-xl p-6 border border-slate-700 shadow-2xl"
          >
            <h3 class="text-xl font-bold text-slate-100 mb-6">
              Emergency Controls
            </h3>

            <div class="space-y-3">
              <button
                title="button"
                type="button"
                id="emergencyBroadcast"
                class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-4 rounded-lg transition-all duration-200 shadow-lg hover:shadow-red-500/25 transform hover:scale-105"
              >
                <svg
                  class="w-5 h-5 mr-2 inline"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M12,8.5A1.5,1.5 0 0,1 10.5,7A1.5,1.5 0 0,1 12,5.5A1.5,1.5 0 0,1 13.5,7A1.5,1.5 0 0,1 12,8.5M14.22,21.39L13.5,18.4C14.58,17.67 15.25,16.5 15.25,15.25C15.25,13.19 13.81,11.75 11.75,11.75C9.69,11.75 8.25,13.19 8.25,15.25C8.25,16.5 8.92,17.67 10,18.4L9.28,21.39L3.61,3.61L20.39,20.39L14.22,21.39Z"
                  />
                </svg>
                Emergency Broadcast
              </button>
              <button
                title="button"
                type="button"
                id="alertPersonnel"
                class="w-full bg-amber-600 hover:bg-amber-700 text-white font-bold py-4 px-4 rounded-lg transition-all duration-200 shadow-lg hover:shadow-amber-500/25 transform hover:scale-105"
              >
                <svg
                  class="w-5 h-5 mr-2 inline"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.5 16.39,17.38 13,17.93V21H11V17.93C7.61,17.38 5,14.5 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z"
                  />
                </svg>
                Alert All Personnel
              </button>
              <button
                title="button"
                type="button"
                id="contactAuthorities"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-4 rounded-lg transition-all duration-200 shadow-lg hover:shadow-blue-500/25 transform hover:scale-105"
              >
                <svg
                  class="w-5 h-5 mr-2 inline"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M6.62,10.79C8.06,13.62 10.38,15.94 13.21,17.38L15.41,15.18C15.69,14.9 16.08,14.82 16.43,14.93C17.55,15.3 18.75,15.5 20,15.5A1,1 0 0,1 21,16.5V20A1,1 0 0,1 20,21A17,17 0 0,1 3,4A1,1 0 0,1 4,3H7.5A1,1 0 0,1 8.5,4C8.5,5.25 8.7,6.45 9.07,7.57C9.18,7.92 9.1,8.31 8.82,8.59L6.62,10.79Z"
                  />
                </svg>
                Contact Authorities
              </button>
            </div>
          </div>

          <!-- System Health -->
          <div
            class="bg-slate-800 rounded-xl p-6 border border-slate-700 shadow-2xl"
          >
            <h3 class="text-xl font-bold text-slate-100 mb-6">System Health</h3>

            <div class="space-y-4" id="systemHealth">
              <!-- System health items will be dynamically populated -->
            </div>
          </div>
        </section>
      </div>

      <!-- Full-Width Live Alerts Feed -->
      <section class="mt-6">
        <div
          class="bg-slate-800 rounded-xl p-6 border border-slate-700 shadow-2xl"
        >
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold text-slate-100 flex items-center">
              <svg
                class="w-6 h-6 mr-3 text-emerald-400"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z"
                />
              </svg>
              Live Alerts Feed
            </h3>
            <div class="flex items-center space-x-4">
              <div class="flex items-center text-sm text-slate-400">
                <div
                  class="w-2 h-2 bg-emerald-500 rounded-full mr-2 animate-pulse"
                ></div>
                <span>Real-time updates</span>
              </div>
              <button
                title="button"
                type="button"
                id="clearAllAlerts"
                class="text-sm text-slate-400 hover:text-slate-200 transition-colors px-3 py-1 rounded-lg hover:bg-slate-700"
              >
                Clear All
              </button>
              <button
                title="button"
                type="button"
                id="exportLog"
                class="text-sm text-slate-400 hover:text-slate-200 transition-colors px-3 py-1 rounded-lg hover:bg-slate-700"
              >
                Export Log
              </button>
            </div>
          </div>

          <!-- Alerts List -->
          <div
            class="space-y-3 max-h-96 overflow-y-auto custom-scrollbar"
            id="alertsList"
          >
            <!-- Alerts will be dynamically populated -->
          </div>

          <!-- No Alerts State -->
          <div class="text-center py-12 hidden" id="noAlertsState">
            <div
              class="w-16 h-16 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-4"
            >
              <svg
                class="w-8 h-8 text-emerald-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
            </div>
            <p class="text-xl font-medium text-slate-300 mb-2">
              All Systems Operating Normally
            </p>
            <p class="text-slate-400">
              No active alerts or incidents to display
            </p>
          </div>
        </div>
      </section>
    </main>

    <!-- Enhanced JavaScript for Real-time Updates and API Integration -->
    <script>
      // Enhanced API Configuration and Data Management with Mock Data Support
      class SafetyMonitorAPI {
        constructor() {
          this.baseURL = "https://api.womensafetyanalytics.com/v1";
          this.wsURL = "wss://ws.womensafetyanalytics.com";
          this.apiKey = "demo_key_safety_monitor";
          this.websocket = null;
          this.refreshInterval = 5000;
          this.isConnected = false;
          this.retryCount = 0;
          this.maxRetries = 3;
          this.usePolling = false;
          this.pollingInterval = null;
          this.mockDataMode = true; // Enable mock data mode for demo

          this.initializeConnection();
        }

        async initializeConnection() {
          try {
            console.log("Initializing Safety Monitor API...");

            if (this.mockDataMode) {
              console.log("Running in mock data mode for demonstration");
              this.isConnected = true;
              this.updateConnectionStatus(true);
              await this.fetchInitialData();
              this.setupPeriodicUpdates();
              return;
            }

            // Try WebSocket connection first
            this.connectWebSocket();

            // Initial data fetch
            await this.fetchInitialData();

            // Set up periodic updates as fallback
            this.setupPeriodicUpdates();
          } catch (error) {
            console.warn("API connection failed, using mock data:", error);
            this.handleConnectionError();
          }
        }

        connectWebSocket() {
          if (this.mockDataMode) {
            console.log("WebSocket disabled in mock data mode");
            return;
          }

          try {
            console.log("Attempting WebSocket connection...");
            this.websocket = new WebSocket(
              `${this.wsURL}?apiKey=${this.apiKey}`
            );

            this.websocket.onopen = () => {
              console.log("âœ… WebSocket connected successfully");
              this.isConnected = true;
              this.retryCount = 0;
              this.usePolling = false;
              this.updateConnectionStatus(true);
            };

            this.websocket.onmessage = (event) => {
              try {
                const data = JSON.parse(event.data);
                this.handleRealtimeUpdate(data);
              } catch (e) {
                console.error("Failed to parse WebSocket message:", e);
              }
            };

            this.websocket.onclose = (event) => {
              console.log("WebSocket disconnected:", event.code, event.reason);
              this.isConnected = false;
              this.updateConnectionStatus(false);

              if (!this.usePolling) {
                this.retryConnection();
              }
            };

            this.websocket.onerror = (error) => {
              console.warn(
                "WebSocket connection error, falling back to polling mode"
              );
              this.handleConnectionError();
            };
          } catch (error) {
            console.warn("WebSocket initialization failed:", error);
            this.fallbackToPolling();
          }
        }

        retryConnection() {
          if (this.retryCount < this.maxRetries && !this.usePolling) {
            this.retryCount++;
            const delay = Math.min(2000 * this.retryCount, 10000);

            console.log(
              `Retrying WebSocket connection (${this.retryCount}/${this.maxRetries}) in ${delay}ms`
            );

            setTimeout(() => {
              if (!this.usePolling) {
                this.connectWebSocket();
              }
            }, delay);
          } else {
            console.log("Max retries reached, switching to polling mode");
            this.fallbackToPolling();
          }
        }

        fallbackToPolling() {
          console.log("ðŸ“Š Switching to polling mode for data updates");
          this.usePolling = true;
          this.isConnected = true; // Mark as connected for polling mode
          this.updateConnectionStatus(true);

          if (this.websocket) {
            this.websocket.close();
            this.websocket = null;
          }
        }

        async fetchInitialData() {
          try {
            console.log("Fetching initial dashboard data...");

            // Use Promise.allSettled to handle partial failures gracefully
            const results = await Promise.allSettled([
              this.fetchCameraData(),
              this.fetchAnalyticsData(),
              this.fetchAlertsData(),
              this.fetchSystemHealth(),
            ]);

            const [cameras, analytics, alerts, system] = results.map((result) =>
              result.status === "fulfilled" ? result.value : null
            );

            if (cameras) this.updateCameraDisplay(cameras);
            if (analytics) this.updateAnalyticsDisplay(analytics);
            if (alerts) this.updateAlertsDisplay(alerts);
            if (system) this.updateSystemHealthDisplay(system);

            console.log("âœ… Initial data loaded successfully");
          } catch (error) {
            console.error("Failed to fetch initial data:", error);
            this.generateMockData();
          }
        }

        async fetchCameraData() {
          if (this.mockDataMode) {
            return this.generateMockCameraData();
          }

          try {
            const response = await fetch(`${this.baseURL}/cameras`, {
              headers: { Authorization: `Bearer ${this.apiKey}` },
            });

            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return await response.json();
          } catch (error) {
            console.warn("API camera data failed, using mock data:", error);
            return this.generateMockCameraData();
          }
        }

        generateMockCameraData() {
          const cameras = [
            {
              id: "CAM-01",
              name: "Main Entrance",
              status: "online",
              location: { lat: 40.7128, lng: -74.006 },
              quality: "HD",
            },
            {
              id: "CAM-02",
              name: "Parking Lot A",
              status: "online",
              location: { lat: 40.713, lng: -74.0062 },
              quality: "4K",
            },
            {
              id: "CAM-03",
              name: "Library Corridor",
              status: "online",
              location: { lat: 40.7126, lng: -74.0058 },
              quality: "FHD",
            },
            {
              id: "CAM-04",
              name: "Cafeteria Area",
              status: Math.random() > 0.8 ? "offline" : "online",
              location: { lat: 40.7132, lng: -74.0064 },
              quality: "HD",
            },
            {
              id: "CAM-05",
              name: "Study Hall",
              status: "online",
              location: { lat: 40.7124, lng: -74.0056 },
              quality: "4K",
            },
            {
              id: "CAM-06",
              name: "Emergency Exit",
              status: "online",
              location: { lat: 40.7134, lng: -74.0066 },
              quality: "FHD",
            },
            {
              id: "CAM-07",
              name: "Gymnasium",
              status: "online",
              location: { lat: 40.7122, lng: -74.0054 },
              quality: "HD",
            },
            {
              id: "CAM-08",
              name: "Admin Block",
              status: "online",
              location: { lat: 40.7136, lng: -74.0068 },
              quality: "4K",
            },
          ];

          const activeCount = cameras.filter(
            (cam) => cam.status === "online"
          ).length;

          return {
            cameras: cameras.slice(0, 6), // Show 6 in grid
            activeCount,
            totalCount: cameras.length,
            allCameras: cameras,
          };
        }

        async fetchAnalyticsData() {
          if (this.mockDataMode) {
            return this.generateMockAnalyticsData();
          }

          try {
            const response = await fetch(`${this.baseURL}/analytics/realtime`, {
              headers: { Authorization: `Bearer ${this.apiKey}` },
            });

            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return await response.json();
          } catch (error) {
            console.warn("API analytics data failed, using mock data:", error);
            return this.generateMockAnalyticsData();
          }
        }

        generateMockAnalyticsData() {
          const baseTotal = 180;
          const variance = Math.floor(Math.random() * 40) - 20; // Â±20 variance
          const total = Math.max(100, baseTotal + variance);

          // More realistic gender distribution (55-75% female in safety-focused scenarios)
          const femalePercentage = Math.floor(Math.random() * 20) + 55; // 55-75%
          const femaleCount = Math.floor((femalePercentage / 100) * total);
          const maleCount = total - femaleCount;

          return {
            total,
            female: { count: femaleCount, percentage: femalePercentage },
            male: { count: maleCount, percentage: 100 - femalePercentage },
            locations: [
              {
                name: "Main Entrance",
                count: Math.floor(total * 0.22),
                status: "safe",
                trend: "+5%",
              },
              {
                name: "Parking Areas",
                count: Math.floor(total * 0.18),
                status: "safe",
                trend: "-2%",
              },
              {
                name: "Academic Buildings",
                count: Math.floor(total * 0.35),
                status: "safe",
                trend: "+8%",
              },
              {
                name: "Common Areas",
                count: Math.floor(total * 0.15),
                status: "monitoring",
                trend: "+12%",
              },
              {
                name: "Outdoor Spaces",
                count: Math.floor(total * 0.1),
                status: "safe",
                trend: "stable",
              },
            ],
            hourlyTrend: this.generateHourlyTrend(),
            lastUpdated: new Date().toISOString(),
          };
        }

        generateHourlyTrend() {
          const hours = [];
          const now = new Date();

          for (let i = 11; i >= 0; i--) {
            const hour = new Date(now - i * 60 * 60 * 1000);
            const baseCount = 150 + Math.floor(Math.random() * 60);
            const femaleRatio = 0.6 + Math.random() * 0.2; // 60-80%

            hours.push({
              time: hour.getHours() + ":00",
              total: baseCount,
              female: Math.floor(baseCount * femaleRatio),
              male: Math.floor(baseCount * (1 - femaleRatio)),
            });
          }

          return hours;
        }

        async fetchAlertsData() {
          if (this.mockDataMode) {
            return this.generateMockAlertsData();
          }

          try {
            const response = await fetch(`${this.baseURL}/alerts/active`, {
              headers: { Authorization: `Bearer ${this.apiKey}` },
            });

            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return await response.json();
          } catch (error) {
            console.warn("API alerts data failed, using mock data:", error);
            return this.generateMockAlertsData();
          }
        }

        generateMockAlertsData() {
          const alertTypes = [
            {
              type: "info",
              title: "System Status Update",
              description:
                "All monitoring systems operational. Regular safety check completed.",
              severity: "low",
            },
            {
              type: "warning",
              title: "Camera Maintenance Required",
              description:
                "Camera CAM-04 showing intermittent connectivity. Scheduled maintenance recommended.",
              severity: "medium",
            },
            {
              type: "info",
              title: "High Traffic Area Detected",
              description:
                "Increased foot traffic in main entrance area. Monitoring enhanced.",
              severity: "low",
            },
          ];

          // Randomly show 0-2 alerts
          const numAlerts = Math.floor(Math.random() * 3);
          const selectedAlerts = alertTypes
            .slice(0, numAlerts)
            .map((alert, index) => ({
              id: `alert_${Date.now()}_${index}`,
              ...alert,
              location: ["Downtown Campus", "North District", "Central Plaza"][
                Math.floor(Math.random() * 3)
              ],
              timestamp: new Date(
                Date.now() - (index + 1) * 60000 * (Math.random() * 10 + 1)
              ).toISOString(),
            }));

          return {
            alerts: selectedAlerts,
            activeCount: selectedAlerts.filter((a) => a.severity !== "low")
              .length,
            totalToday: Math.floor(Math.random() * 5) + 3,
          };
        }

        async fetchSystemHealth() {
          if (this.mockDataMode) {
            return this.generateMockSystemHealth();
          }

          try {
            const response = await fetch(`${this.baseURL}/system/health`, {
              headers: { Authorization: `Bearer ${this.apiKey}` },
            });

            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return await response.json();
          } catch (error) {
            console.warn("API system health failed, using mock data:", error);
            return this.generateMockSystemHealth();
          }
        }

        generateMockSystemHealth() {
          const uptime = 99.5 + Math.random() * 0.4; // 99.5-99.9%
          const processingTime = 150 + Math.floor(Math.random() * 100); // 150-250ms
          const queryRate = 1000 + Math.floor(Math.random() * 500); // 1000-1500/min

          return {
            network: {
              status: "online",
              uptime: `${uptime.toFixed(1)}%`,
              latency: `${Math.floor(Math.random() * 20) + 10}ms`,
            },
            ai: {
              status: "active",
              processing: `${processingTime}ms avg`,
              accuracy: "97.8%",
            },
            database: {
              status: "connected",
              queries: `${(queryRate / 1000).toFixed(1)}k/min`,
              storage: "78% used",
            },
            cameras: {
              status: "operational",
              activeCount: Math.floor(Math.random() * 3) + 13, // 13-15 active
              totalCount: 16,
            },
            lastUpdate: Date.now() - Math.floor(Math.random() * 30000), // Last 30 seconds
            overallStatus: "healthy",
          };
        }

        handleRealtimeUpdate(data) {
          switch (data.type) {
            case "analytics":
              this.updateAnalyticsDisplay(data.payload);
              this.showUpdateNotification("Analytics updated");
              break;
            case "camera":
              this.updateCameraStatus(data.payload);
              this.showUpdateNotification("Camera status changed");
              break;
            case "alert":
              this.addNewAlert(data.payload);
              this.showUpdateNotification("New alert received", "warning");
              break;
            case "system":
              this.updateSystemHealthDisplay(data.payload);
              break;
            default:
              console.log("Unknown realtime update type:", data.type);
          }
        }

        setupPeriodicUpdates() {
          // Clear existing interval
          if (this.pollingInterval) {
            clearInterval(this.pollingInterval);
          }

          this.pollingInterval = setInterval(async () => {
            try {
              // Only update if not using active WebSocket or in mock mode
              if (!this.isConnected || this.usePolling || this.mockDataMode) {
                console.log("ðŸ”„ Refreshing dashboard data...");

                const [analytics, system] = await Promise.allSettled([
                  this.fetchAnalyticsData(),
                  this.fetchSystemHealth(),
                ]);

                if (analytics.status === "fulfilled") {
                  this.updateAnalyticsDisplay(analytics.value);
                }

                if (system.status === "fulfilled") {
                  this.updateSystemHealthDisplay(system.value);
                }

                // Occasionally update alerts and cameras
                if (Math.random() > 0.7) {
                  const alerts = await this.fetchAlertsData();
                  this.updateAlertsDisplay(alerts);
                }
              }
            } catch (error) {
              console.error("Periodic update failed:", error);
            }
          }, this.refreshInterval);

          console.log(
            `ðŸ“… Periodic updates scheduled every ${
              this.refreshInterval / 1000
            }s`
          );
        }

        updateConnectionStatus(connected) {
          const statusElement = document.getElementById("connectionStatus");
          const textElement = document.getElementById("connectionText");

          if (connected) {
            statusElement.className =
              "w-2 h-2 bg-emerald-500 rounded-full animate-pulse";
            textElement.textContent = this.mockDataMode
              ? "Live Demo"
              : "Connected";
            textElement.className = "text-emerald-400";
          } else {
            statusElement.className =
              "w-2 h-2 bg-amber-500 rounded-full animate-pulse";
            textElement.textContent = "Reconnecting...";
            textElement.className = "text-amber-400";
          }
        }

        generateMockData() {
          console.log(
            "ðŸŽ­ Generating comprehensive mock data for demonstration"
          );
          this.fetchInitialData();
        }

        handleConnectionError() {
          console.log(
            "ðŸ”„ Connection error handled, switching to mock data mode"
          );
          this.mockDataMode = true;
          this.updateConnectionStatus(true);
          this.fallbackToPolling();
          this.generateMockData();
        }

        // Enhanced UI Update Methods
        updateCameraDisplay(data) {
          const grid = document.getElementById("cameraGrid");
          const activeCameraCount =
            document.getElementById("activeCameraCount");
          const totalCameraCount = document.getElementById("totalCameraCount");
          const activeCamerasStatus = document.getElementById(
            "activeCamerasStatus"
          );

          activeCameraCount.textContent = data.activeCount;
          totalCameraCount.textContent = data.totalCount;
          activeCamerasStatus.textContent = `${data.activeCount}/${data.totalCount}`;

          grid.innerHTML = data.cameras
            .map(
              (camera) => `
                <div class="relative bg-slate-900 rounded-xl overflow-hidden aspect-video group hover:scale-[1.02] transition-all duration-300 shadow-lg border border-slate-700 hover:border-slate-600">
                    <div class="absolute inset-0 bg-gradient-to-br from-slate-800 to-slate-900"></div>
                    
                    <!-- Camera Feed Placeholder -->
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="text-center">
                            <div class="relative mb-2">
                                <svg class="w-12 h-12 text-slate-600 mx-auto" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M15,8V16H5V8H15M16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5V7A1,1 0 0,0 16,6Z"/>
                                </svg>
                                ${
                                  camera.status === "online"
                                    ? '<div class="absolute -top-1 -right-1 w-3 h-3 bg-emerald-500 rounded-full animate-pulse"></div>'
                                    : '<div class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></div>'
                                }
                            </div>
                            <p class="text-xs text-slate-400">${
                              camera.status === "online"
                                ? "Live Feed"
                                : "Offline"
                            }</p>
                            <p class="text-xs text-slate-500 mt-1">${
                              camera.quality || "HD"
                            }</p>
                        </div>
                    </div>
                    
                    <!-- Camera ID and Status -->
                    <div class="absolute top-3 left-3 flex items-center space-x-2">
                        <div class="w-2 h-2 ${
                          camera.status === "online"
                            ? "bg-emerald-500"
                            : "bg-red-500"
                        } rounded-full ${
                camera.status === "online" ? "animate-pulse" : ""
              }"></div>
                        <span class="text-xs text-white bg-black bg-opacity-70 px-2 py-1 rounded font-medium backdrop-blur-sm">${
                          camera.id
                        }</span>
                    </div>
                    
                    <!-- Camera Toggle -->
                    <div class="absolute top-3 right-3">
                        <button title="button" type="button" class="camera-toggle ${
                          camera.status === "online"
                            ? "bg-emerald-600 hover:bg-emerald-700"
                            : "bg-slate-600 hover:bg-slate-700"
                        } text-white text-xs px-3 py-1.5 rounded-lg font-medium transition-all duration-200 shadow-lg" data-camera="${
                camera.id
              }">
                            ${camera.status === "online" ? "ON" : "OFF"}
                        </button>
                    </div>
                    
                    <!-- Camera Name -->
                    <div class="absolute bottom-3 left-3 right-3">
                        <div class="text-sm text-white bg-black bg-opacity-70 px-3 py-2 rounded-lg font-medium truncate backdrop-blur-sm">
                            ${camera.name}
                        </div>
                    </div>
                    
                    <!-- Hover Overlay -->
                    <div class="absolute inset-0 bg-emerald-500 bg-opacity-0 group-hover:bg-opacity-5 transition-all duration-300 pointer-events-none"></div>
                </div>
            `
            )
            .join("");

          // Add event listeners for camera toggles
          document.querySelectorAll(".camera-toggle").forEach((button) => {
            button.addEventListener("click", (e) => {
              this.toggleCamera(e.target.dataset.camera);
            });
          });
        }

        updateAnalyticsDisplay(data) {
          // Update summary metrics
          document.getElementById("totalMonitored").textContent =
            data.total.toLocaleString();
          document.getElementById("femalePresence").textContent =
            data.female.percentage + "%";

          // Update response time with more realistic values
          const responseTimeEl = document.getElementById("responseTime");
          const avgResponseTime = Math.floor(Math.random() * 60) + 30; // 30-90 seconds
          responseTimeEl.textContent =
            avgResponseTime < 60
              ? `${avgResponseTime}s`
              : `${Math.floor(avgResponseTime / 60)}m ${avgResponseTime % 60}s`;

          // Update circular progress chart
          this.updateCircularChart(data);

          // Update distribution bars
          this.updateDistributionBars(data);

          // Update location breakdown
          this.updateLocationBreakdown(data);

          // Show last updated time
          const lastUpdated = new Date(data.lastUpdated || Date.now());
          console.log(
            `ðŸ“Š Analytics updated at ${lastUpdated.toLocaleTimeString()}`
          );
        }

        updateCircularChart(data) {
          const femaleArc = document.getElementById("femaleArc");
          const maleArc = document.getElementById("maleArc");
          const totalCircle = document.getElementById("totalCountCircle");

          const circumference = 2 * Math.PI * 40; // radius = 40
          const femaleLength = (data.female.percentage / 100) * circumference;
          const maleLength = (data.male.percentage / 100) * circumference;

          // Animate the arcs
          femaleArc.style.strokeDasharray = `${femaleLength} ${circumference}`;
          maleArc.style.strokeDasharray = `${maleLength} ${circumference}`;
          maleArc.style.strokeDashoffset = -femaleLength;

          totalCircle.textContent = data.total.toLocaleString();
        }

        updateDistributionBars(data) {
          // Female distribution
          const femaleElements = {
            percentage: document.getElementById("femalePercentage"),
            count: document.getElementById("femaleCount"),
            bar: document.getElementById("femaleBar"),
            barText: document.getElementById("femaleBarText"),
          };

          femaleElements.percentage.textContent = data.female.percentage + "%";
          femaleElements.count.textContent = data.female.count.toLocaleString();
          femaleElements.bar.style.width = data.female.percentage + "%";

          // Show percentage on bar if wide enough
          if (data.female.percentage > 20) {
            femaleElements.barText.textContent = data.female.percentage + "%";
            femaleElements.barText.style.opacity = "1";
          } else {
            femaleElements.barText.style.opacity = "0";
          }

          // Male distribution
          const maleElements = {
            percentage: document.getElementById("malePercentage"),
            count: document.getElementById("maleCount"),
            bar: document.getElementById("maleBar"),
            barText: document.getElementById("maleBarText"),
          };

          maleElements.percentage.textContent = data.male.percentage + "%";
          maleElements.count.textContent = data.male.count.toLocaleString();
          maleElements.bar.style.width = data.male.percentage + "%";

          if (data.male.percentage > 20) {
            maleElements.barText.textContent = data.male.percentage + "%";
            maleElements.barText.style.opacity = "1";
          } else {
            maleElements.barText.style.opacity = "0";
          }
        }

        updateLocationBreakdown(data) {
          const locationBreakdown =
            document.getElementById("locationBreakdown");
          locationBreakdown.innerHTML = data.locations
            .map(
              (location) => `
                <div class="bg-slate-700/50 rounded-xl p-4 hover:bg-slate-700/70 transition-all duration-200 border border-slate-600/50 hover:border-slate-500/50">
                    <div class="flex items-center justify-between mb-2">
                        <div class="text-sm text-slate-400">${
                          location.name
                        }</div>
                        <div class="text-xs px-2 py-1 rounded-full ${
                          location.status === "safe"
                            ? "bg-emerald-500/20 text-emerald-400"
                            : "bg-amber-500/20 text-amber-400"
                        }">
                            ${
                              location.status === "safe"
                                ? "âœ“ Safe"
                                : "âš  Monitoring"
                            }
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="text-lg font-bold text-slate-200">${
                          location.count
                        } people</div>
                        ${
                          location.trend
                            ? `<div class="text-xs text-slate-500">${location.trend}</div>`
                            : ""
                        }
                    </div>
                </div>
            `
            )
            .join("");
        }

        updateAlertsDisplay(data) {
          const alertsList = document.getElementById("alertsList");
          const noAlertsState = document.getElementById("noAlertsState");
          const activeAlerts = document.getElementById("activeAlerts");
          const currentAlertsStatus = document.getElementById(
            "currentAlertsStatus"
          );
          const lastAlertTime = document.getElementById("lastAlertTime");

          activeAlerts.textContent = data.activeCount;
          currentAlertsStatus.textContent = data.activeCount;

          if (data.alerts.length === 0) {
            alertsList.classList.add("hidden");
            noAlertsState.classList.remove("hidden");
            lastAlertTime.textContent = "None today";
          } else {
            alertsList.classList.remove("hidden");
            noAlertsState.classList.add("hidden");

            // Update last alert time
            const latestAlert = data.alerts[0];
            lastAlertTime.textContent = this.formatTime(latestAlert.timestamp);

            alertsList.innerHTML = data.alerts
              .map((alert) => {
                const severityColors = {
                  low: "border-emerald-500 bg-emerald-500/10",
                  medium: "border-amber-500 bg-amber-500/10",
                  high: "border-red-500 bg-red-500/10",
                };

                const iconColors = {
                  low: "bg-emerald-500",
                  medium: "bg-amber-500",
                  high: "bg-red-500",
                };

                return `
                        <div class="flex items-start space-x-4 p-4 rounded-xl border-l-4 ${
                          severityColors[alert.severity]
                        } hover:bg-slate-700/50 transition-all duration-200" data-alert-id="${
                  alert.id
                }">
                            <div class="flex-shrink-0">
                                <div class="w-10 h-10 ${
                                  iconColors[alert.severity]
                                } rounded-full flex items-center justify-center shadow-lg">
                                    ${this.getAlertIcon(alert.type)}
                                </div>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center justify-between mb-1">
                                    <h4 class="text-sm font-semibold text-slate-200">${
                                      alert.title
                                    }</h4>
                                    <span class="text-xs text-slate-400">${this.formatTime(
                                      alert.timestamp
                                    )}</span>
                                </div>
                                <p class="text-sm text-slate-400 mb-2">${
                                  alert.description
                                }</p>
                                <div class="flex items-center space-x-3">
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${this.getSeverityBadge(
                                      alert.severity
                                    )}">
                                        ${alert.severity.toUpperCase()}
                                    </span>
                                    <span class="text-xs text-slate-500 flex items-center">
                                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12,2C13.65,2 15,3.35 15,5C15,6.65 13.65,8 12,8C10.35,8 9,6.65 9,5C9,3.35 10.35,2 12,2M21,9V7L15,1H5C3.89,1 3,1.89 3,3V21A2,2 0 0,0 5,23H19A2,2 0 0,0 21,21V9M19,21H5V3H13V9H19V21Z"/>
                                        </svg>
                                        ${alert.location}
                                    </span>
                                </div>
                            </div>
                            <button title="button" type="button" class="text-slate-400 hover:text-slate-200 transition-colors p-1 rounded-lg hover:bg-slate-600" onclick="safetyAPI.dismissAlert('${
                              alert.id
                            }')">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    `;
              })
              .join("");
          }
        }

        updateSystemHealthDisplay(data) {
          const systemHealth = document.getElementById("systemHealth");
          const responseTimeStatus =
            document.getElementById("responseTimeStatus");

          // Update response time
          if (data.ai?.processing) {
            const processingTime = parseInt(data.ai.processing);
            responseTimeStatus.textContent =
              processingTime > 60000
                ? "> 1min"
                : `< ${Math.ceil(processingTime / 1000)}s`;
          }

          const healthItems = [
            {
              name: "Network Connection",
              status: data.network.status,
              detail: data.network.uptime,
              icon: "ðŸŒ",
            },
            {
              name: "AI Processing",
              status: data.ai.status,
              detail: data.ai.processing,
              icon: "ðŸ¤–",
            },
            {
              name: "Database",
              status: data.database.status,
              detail: data.database.queries,
              icon: "ðŸ’¾",
            },
            {
              name: "Camera System",
              status: data.cameras?.status || "operational",
              detail: `${data.cameras?.activeCount || 15}/${
                data.cameras?.totalCount || 16
              } active`,
              icon: "ðŸ“¹",
            },
            {
              name: "Last Updated",
              status: "active",
              detail: this.formatTime(data.lastUpdate),
              icon: "ðŸ•",
            },
          ];

          systemHealth.innerHTML = healthItems
            .map(
              (item) => `
                <div class="flex items-center justify-between p-3 bg-slate-700/50 rounded-lg hover:bg-slate-700/70 transition-all duration-200 border border-slate-600/30">
                    <span class="text-sm text-slate-300 flex items-center">
                        <div class="w-2 h-2 ${this.getStatusColor(
                          item.status
                        )} rounded-full mr-3 ${
                item.status === "active" ||
                item.status === "online" ||
                item.status === "connected" ||
                item.status === "operational"
                  ? "animate-pulse"
                  : ""
              }"></div>
                        <span class="mr-2">${item.icon}</span>
                        ${item.name}
                    </span>
                    <div class="text-right">
                        <div class="text-sm ${this.getStatusTextColor(
                          item.status
                        )} font-medium">
                            ${
                              item.status === "active" &&
                              item.name === "Last Updated"
                                ? item.detail
                                : item.status
                            }
                        </div>
                        <div class="text-xs text-slate-500 mt-0.5">
                            ${
                              item.detail && item.name !== "Last Updated"
                                ? item.detail
                                : ""
                            }
                        </div>
                    </div>
                </div>
            `
            )
            .join("");
        }

        getStatusColor(status) {
          const colors = {
            online: "bg-emerald-500",
            active: "bg-emerald-500",
            connected: "bg-emerald-500",
            operational: "bg-emerald-500",
            offline: "bg-red-500",
            error: "bg-red-500",
            warning: "bg-amber-500",
            maintenance: "bg-amber-500",
          };
          return colors[status] || "bg-slate-500";
        }

        getStatusTextColor(status) {
          const colors = {
            online: "text-emerald-400",
            active: "text-emerald-400",
            connected: "text-emerald-400",
            operational: "text-emerald-400",
            offline: "text-red-400",
            error: "text-red-400",
            warning: "text-amber-400",
            maintenance: "text-amber-400",
          };
          return colors[status] || "text-slate-400";
        }

        // Enhanced Utility Methods
        getAlertIcon(type) {
          const icons = {
            info: '<svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M11,16.5L18,9.5L16.59,8.09L11,13.67L7.41,10.09L6,11.5L11,16.5Z"/></svg>',
            warning:
              '<svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M13,14H11V10H13M13,18H11V16H13M1,21H23L12,2L1,21Z"/></svg>',
            error:
              '<svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"/></svg>',
            success:
              '<svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M11,16.5L18,9.5L16.59,8.09L11,13.67L7.41,10.09L6,11.5L11,16.5Z"/></svg>',
          };
          return icons[type] || icons.info;
        }

        getSeverityBadge(severity) {
          const badges = {
            low: "bg-emerald-500/20 text-emerald-300 border border-emerald-500/30",
            medium: "bg-amber-500/20 text-amber-300 border border-amber-500/30",
            high: "bg-red-500/20 text-red-300 border border-red-500/30",
          };
          return badges[severity] || badges.low;
        }

        formatTime(timestamp) {
          const now = new Date();
          const time = new Date(timestamp);
          const diff = Math.floor((now - time) / 1000);

          if (diff < 10) return "just now";
          if (diff < 60) return `${diff}s ago`;
          if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
          if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;

          // If more than a day, show actual time
          return (
            time.toLocaleDateString() +
            " " +
            time.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" })
          );
        }

        showUpdateNotification(message, type = "info") {
          // Create notification element
          const notification = document.createElement("div");
          const bgColor =
            type === "warning"
              ? "bg-amber-500"
              : type === "error"
              ? "bg-red-500"
              : "bg-emerald-500";

          notification.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300`;
          notification.textContent = message;

          document.body.appendChild(notification);

          // Animate in
          setTimeout(() => {
            notification.style.transform = "translateX(0)";
          }, 100);

          // Animate out and remove
          setTimeout(() => {
            notification.style.transform = "translateX(full)";
            setTimeout(() => notification.remove(), 300);
          }, 3000);
        }

        // Enhanced API Methods
        async toggleCamera(cameraId) {
          try {
            console.log(`ðŸŽ¥ Toggling camera ${cameraId}`);

            if (this.mockDataMode) {
              // Simulate toggle with visual feedback
              const button = document.querySelector(
                `[data-camera="${cameraId}"]`
              );
              if (button) {
                const isCurrentlyOn = button.textContent === "ON";
                button.textContent = isCurrentlyOn ? "OFF" : "ON";
                button.className = button.className.replace(
                  isCurrentlyOn
                    ? "bg-emerald-600 hover:bg-emerald-700"
                    : "bg-slate-600 hover:bg-slate-700",
                  isCurrentlyOn
                    ? "bg-slate-600 hover:bg-slate-700"
                    : "bg-emerald-600 hover:bg-emerald-700"
                );

                this.showUpdateNotification(
                  `Camera ${cameraId} ${isCurrentlyOn ? "disabled" : "enabled"}`
                );
              }
              return { success: true };
            }

            const response = await fetch(
              `${this.baseURL}/cameras/${cameraId}/toggle`,
              {
                method: "POST",
                headers: { Authorization: `Bearer ${this.apiKey}` },
              }
            );

            if (!response.ok) throw new Error(`HTTP ${response.status}`);

            const result = await response.json();
            this.showUpdateNotification(`Camera ${cameraId} ${result.status}`);
            return result;
          } catch (error) {
            console.error(`Failed to toggle camera ${cameraId}:`, error);
            this.showUpdateNotification(
              `Camera toggle failed: ${error.message}`,
              "error"
            );
            return { success: false, error };
          }
        }

        async dismissAlert(alertId) {
          try {
            console.log(`ðŸš¨ Dismissing alert ${alertId}`);

            // Visual feedback - remove from display
            const alertElement = document.querySelector(
              `[data-alert-id="${alertId}"]`
            );
            if (alertElement) {
              alertElement.style.transform = "translateX(100%)";
              alertElement.style.opacity = "0";
              setTimeout(() => alertElement.remove(), 300);
            }

            if (!this.mockDataMode) {
              const response = await fetch(
                `${this.baseURL}/alerts/${alertId}/dismiss`,
                {
                  method: "POST",
                  headers: { Authorization: `Bearer ${this.apiKey}` },
                }
              );

              if (!response.ok) throw new Error(`HTTP ${response.status}`);
            }

            this.showUpdateNotification("Alert dismissed");
            return { success: true };
          } catch (error) {
            console.error(`Failed to dismiss alert ${alertId}:`, error);
            this.showUpdateNotification(
              `Alert dismissal failed: ${error.message}`,
              "error"
            );
            return { success: false, error };
          }
        }

        async exportAnalytics() {
          try {
            console.log("ðŸ“Š Exporting analytics data...");

            const data = await this.fetchAnalyticsData();
            const exportData = {
              exportTime: new Date().toISOString(),
              summary: {
                totalPeople: data.total,
                femaleCount: data.female.count,
                maleCount: data.male.count,
                femalePercentage: data.female.percentage,
              },
              locationBreakdown: data.locations,
              hourlyTrend: data.hourlyTrend || [],
            };

            // Create and download CSV
            const csv = this.convertToCSV(exportData);
            this.downloadFile(
              csv,
              `safety-analytics-${new Date().toISOString().split("T")[0]}.csv`,
              "text/csv"
            );

            this.showUpdateNotification("Analytics data exported successfully");
            return { success: true };
          } catch (error) {
            console.error("Failed to export analytics:", error);
            this.showUpdateNotification(
              "Export failed: " + error.message,
              "error"
            );
            return { success: false, error };
          }
        }

        async exportAlertLog() {
          try {
            console.log("ðŸ“‹ Exporting alert log...");

            const alerts = await this.fetchAlertsData();
            const logData = {
              exportTime: new Date().toISOString(),
              totalAlerts: alerts.alerts.length,
              activeAlerts: alerts.activeCount,
              alerts: alerts.alerts.map((alert) => ({
                id: alert.id,
                type: alert.type,
                severity: alert.severity,
                title: alert.title,
                description: alert.description,
                location: alert.location,
                timestamp: alert.timestamp,
              })),
            };

            const json = JSON.stringify(logData, null, 2);
            this.downloadFile(
              json,
              `alert-log-${new Date().toISOString().split("T")[0]}.json`,
              "application/json"
            );

            this.showUpdateNotification("Alert log exported successfully");
            return { success: true };
          } catch (error) {
            console.error("Failed to export alert log:", error);
            this.showUpdateNotification(
              "Export failed: " + error.message,
              "error"
            );
            return { success: false, error };
          }
        }

        convertToCSV(data) {
          const rows = [];

          // Summary section
          rows.push(["Summary Data"]);
          rows.push(["Total People", data.summary.totalPeople]);
          rows.push(["Female Count", data.summary.femaleCount]);
          rows.push(["Male Count", data.summary.maleCount]);
          rows.push(["Female Percentage", data.summary.femalePercentage + "%"]);
          rows.push([]);

          // Location breakdown
          rows.push(["Location Breakdown"]);
          rows.push(["Location", "Count", "Status", "Trend"]);
          data.locationBreakdown.forEach((location) => {
            rows.push([
              location.name,
              location.count,
              location.status,
              location.trend || "",
            ]);
          });

          return rows.map((row) => row.join(",")).join("\n");
        }

        downloadFile(content, filename, contentType) {
          const blob = new Blob([content], { type: contentType });
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = url;
          link.download = filename;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        }

        // Cleanup method
        destroy() {
          if (this.pollingInterval) {
            clearInterval(this.pollingInterval);
          }
          if (this.websocket) {
            this.websocket.close();
          }
          console.log("ðŸ§¹ SafetyMonitorAPI cleaned up");
        }
      }

      // Enhanced Application Initialization
      let safetyAPI;

      document.addEventListener("DOMContentLoaded", function () {
        console.log("ðŸš€ Initializing Women Safety Analytics Dashboard...");

        // Initialize API with error handling
        try {
          safetyAPI = new SafetyMonitorAPI();
        } catch (error) {
          console.error("Failed to initialize SafetyMonitorAPI:", error);
          showErrorMessage(
            "Failed to initialize the safety monitoring system. Please refresh the page."
          );
        }

        // Enhanced loading sequence
        simulateLoadingSequence();

        // Setup all event listeners
        setupEventListeners();

        // Setup responsive features
        setupResponsiveFeatures();

        // Setup keyboard shortcuts
        setupKeyboardShortcuts();

        console.log("âœ… Dashboard initialization complete");
      });

      function simulateLoadingSequence() {
        const loadingSteps = [
          { text: "Connecting to safety network...", delay: 500 },
          { text: "Loading camera feeds...", delay: 800 },
          { text: "Initializing analytics engine...", delay: 600 },
          { text: "Synchronizing real-time data...", delay: 700 },
          { text: "Dashboard ready!", delay: 300 },
        ];

        let currentStep = 0;
        const loadingText = document.querySelector("#loadingOverlay p");

        function nextStep() {
          if (currentStep < loadingSteps.length) {
            const step = loadingSteps[currentStep];
            loadingText.textContent = step.text;
            currentStep++;
            setTimeout(nextStep, step.delay);
          } else {
            // Hide loading overlay
            setTimeout(() => {
              const overlay = document.getElementById("loadingOverlay");
              overlay.style.opacity = "0";
              setTimeout(() => {
                overlay.style.display = "none";
              }, 500);
            }, 500);
          }
        }

        nextStep();
      }

      function setupEventListeners() {
        // Mobile menu toggle
        document
          .getElementById("mobileMenuToggle")
          .addEventListener("click", function () {
            const mobileNav = document.getElementById("mobileNav");
            mobileNav.classList.toggle("hidden");
          });

        // Enhanced refresh functionality
        document
          .getElementById("refreshToggle")
          .addEventListener("click", function () {
            const icon = this.querySelector("svg");
            const button = this;

            // Disable button during refresh
            button.disabled = true;
            button.style.opacity = "0.5";

            // Animate icon
            icon.style.transform = "rotate(360deg)";
            icon.style.transition = "transform 0.5s ease";

            // Trigger manual refresh
            safetyAPI
              .fetchInitialData()
              .then(() => {
                // Re-enable button
                button.disabled = false;
                button.style.opacity = "1";

                // Reset rotation
                setTimeout(() => {
                  icon.style.transform = "rotate(0deg)";
                }, 500);

                safetyAPI.showUpdateNotification("Dashboard refreshed");
              })
              .catch((error) => {
                console.error("Manual refresh failed:", error);
                button.disabled = false;
                button.style.opacity = "1";
                safetyAPI.showUpdateNotification("Refresh failed", "error");
              });
          });

        // Location selector with enhanced feedback
        document
          .getElementById("locationSelector")
          .addEventListener("change", function (e) {
            const selectedLocation = e.target.value;
            console.log("ðŸ“ Location changed to:", selectedLocation);

            // Show loading state
            const option = e.target.selectedOptions[0];
            const originalText = option.textContent;
            option.textContent = originalText + " (Loading...)";

            // Trigger location-specific data fetch
            safetyAPI.fetchInitialData().then(() => {
              option.textContent = originalText;
              safetyAPI.showUpdateNotification(`Switched to ${originalText}`);
            });
          });

        // Enhanced emergency buttons with confirmations
        document
          .getElementById("emergencyBroadcast")
          .addEventListener("click", function () {
            showConfirmationModal(
              "Emergency Broadcast",
              "This will send an immediate emergency alert to all personnel and connected systems. Are you sure?",
              () => {
                console.log("ðŸš¨ Emergency broadcast activated");
                safetyAPI.showUpdateNotification(
                  "Emergency broadcast sent to all personnel",
                  "warning"
                );
                // Implement emergency broadcast logic
              }
            );
          });

        document
          .getElementById("alertPersonnel")
          .addEventListener("click", function () {
            showConfirmationModal(
              "Alert Personnel",
              "This will notify all security personnel about the current situation. Continue?",
              () => {
                console.log("ðŸ‘® Alerting all personnel");
                safetyAPI.showUpdateNotification(
                  "All personnel have been alerted",
                  "warning"
                );
                // Implement personnel alert logic
              }
            );
          });

        document
          .getElementById("contactAuthorities")
          .addEventListener("click", function () {
            showConfirmationModal(
              "Contact Authorities",
              "This will immediately contact local law enforcement and emergency services. This action will be logged. Are you sure?",
              () => {
                console.log("ðŸš” Contacting authorities");
                safetyAPI.showUpdateNotification(
                  "Authorities have been contacted",
                  "error"
                );
                // Implement authorities contact logic
              }
            );
          });

        // Enhanced camera controls
        document
          .getElementById("enableAllCameras")
          .addEventListener("click", function () {
            const button = this;
            button.disabled = true;
            button.textContent = "Enabling...";

            setTimeout(() => {
              console.log("ðŸ“¹ Enabling all cameras");
              safetyAPI.showUpdateNotification("All cameras have been enabled");
              button.disabled = false;
              button.innerHTML = `
                    <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                    All Cameras Enabled
                `;
              // Implement enable all cameras logic
            }, 1500);
          });

        document
          .getElementById("viewFullGrid")
          .addEventListener("click", function () {
            console.log("ðŸ–¼ï¸ Opening full camera grid view");
            // Implement full grid view - could open a modal or new page
            safetyAPI.showUpdateNotification("Full grid view coming soon");
          });

        // Enhanced export functions
        document
          .getElementById("exportAnalytics")
          .addEventListener("click", function () {
            safetyAPI.exportAnalytics();
          });

        document
          .getElementById("exportLog")
          .addEventListener("click", function () {
            safetyAPI.exportAlertLog();
          });

        // Enhanced clear alerts
        document
          .getElementById("clearAllAlerts")
          .addEventListener("click", function () {
            showConfirmationModal(
              "Clear All Alerts",
              "This will clear all current alerts from the dashboard. This action cannot be undone.",
              () => {
                console.log("ðŸ§¹ Clearing all alerts");
                document.getElementById("alertsList").innerHTML = "";
                document
                  .getElementById("noAlertsState")
                  .classList.remove("hidden");
                document.getElementById("activeAlerts").textContent = "0";
                document.getElementById("currentAlertsStatus").textContent =
                  "0";
                safetyAPI.showUpdateNotification("All alerts cleared");
              }
            );
          });

        // Fullscreen camera button
        document
          .getElementById("fullscreenCameras")
          .addEventListener("click", function () {
            console.log("ðŸ” Fullscreen camera view requested");
            safetyAPI.showUpdateNotification("Fullscreen view coming soon");
          });
      }

      function setupResponsiveFeatures() {
        // Enhanced smooth scrolling
        document.documentElement.style.scrollBehavior = "smooth";

        // Intersection observer for staggered animations
        const observerOptions = {
          threshold: 0.1,
          rootMargin: "0px 0px -50px 0px",
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry, index) => {
            if (entry.isIntersecting) {
              setTimeout(() => {
                entry.target.style.opacity = "1";
                entry.target.style.transform = "translateY(0)";
              }, index * 100); // Stagger the animations
            }
          });
        }, observerOptions);

        // Observe all main sections with initial setup
        document.querySelectorAll("section").forEach((section, index) => {
          section.style.opacity = "0";
          section.style.transform = "translateY(20px)";
          section.style.transition = `opacity 0.6s ease ${
            index * 0.1
          }s, transform 0.6s ease ${index * 0.1}s`;
          observer.observe(section);
        });

        // Add resize handler for responsive adjustments
        window.addEventListener(
          "resize",
          debounce(() => {
            console.log("ðŸ“± Window resized, adjusting layout");
            // Add any responsive adjustments here
          }, 250)
        );
      }

      function setupKeyboardShortcuts() {
        document.addEventListener("keydown", function (e) {
          // Ctrl/Cmd + R: Manual refresh
          if ((e.ctrlKey || e.metaKey) && e.key === "r" && e.shiftKey) {
            e.preventDefault();
            document.getElementById("refreshToggle").click();
          }

          // Escape: Close any open modals
          if (e.key === "Escape") {
            closeAllModals();
          }

          // F11: Toggle camera fullscreen (when implemented)
          if (e.key === "F11") {
            e.preventDefault();
            document.getElementById("fullscreenCameras").click();
          }
        });
      }

      // Enhanced Utility Functions
      function showConfirmationModal(title, message, onConfirm) {
        const modal = document.createElement("div");
        modal.className =
          "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 backdrop-blur-sm";
        modal.innerHTML = `
            <div class="bg-slate-800 rounded-xl p-6 max-w-md mx-4 border border-slate-700 shadow-2xl">
                <h3 class="text-xl font-bold text-slate-100 mb-4">${title}</h3>
                <p class="text-slate-300 mb-6">${message}</p>
                <div class="flex space-x-3 justify-end">
                    <button title="button" type="button" id="cancelBtn" class="px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg transition-colors">
                        Cancel
                    </button>
                    <button title="button" type="button" id="confirmBtn" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors">
                        Confirm
                    </button>
                </div>
            </div>
        `;

        document.body.appendChild(modal);

        // Event listeners
        modal.querySelector("#cancelBtn").addEventListener("click", () => {
          modal.remove();
        });

        modal.querySelector("#confirmBtn").addEventListener("click", () => {
          onConfirm();
          modal.remove();
        });

        // Close on backdrop click
        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            modal.remove();
          }
        });
      }

      function showErrorMessage(message) {
        const errorDiv = document.createElement("div");
        errorDiv.className =
          "fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-6 py-3 rounded-lg shadow-lg z-50";
        errorDiv.textContent = message;

        document.body.appendChild(errorDiv);

        setTimeout(() => {
          errorDiv.remove();
        }, 5000);
      }

      function closeAllModals() {
        document.querySelectorAll(".fixed.inset-0").forEach((modal) => {
          if (modal.id !== "loadingOverlay") {
            modal.remove();
          }
        });
      }

      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      // Enhanced custom scrollbar styles
      const style = document.createElement("style");
      style.textContent = `
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgb(51, 65, 85);
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgb(148, 163, 184);
            border-radius: 3px;
            transition: background 0.2s ease;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgb(203, 213, 225);
        }
        
        /* Enhanced animations */
        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .animate-pulse-slow {
            animation: pulse-slow 2s infinite;
        }
        
        /* Button hover effects */
        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
    `;
      document.head.appendChild(style);

      // Cleanup on page unload
      window.addEventListener("beforeunload", () => {
        if (safetyAPI) {
          safetyAPI.destroy();
        }
      });
    </script>
    <script
      id="dhws-dataInjector"
      src="../public/dhws-data-injector.js"
    ></script>
  </body>
</html>
